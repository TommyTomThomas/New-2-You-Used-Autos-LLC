<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Owner Admin | New 2 You Used Autos LLC</title>
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
<header class="nav">
  <div class="brand">
    <div class="name">Owner Admin</div>
    <small>New 2 You Used Autos LLC</small>
  </div>
  <nav>
    <a class="btn secondary" href="/">Home</a>
    <a class="btn secondary" href="/inventory">Inventory</a>
  </nav>
</header>

<main class="container" id="app">
  <section id="loginSection">
    <h2>Owner Login</h2>
    <p>Enter the private password to manage vehicles.</p>
    <input id="password" type="password" placeholder="Admin Password" />
    <p><button class="btn" id="loginBtn">Log In</button></p>
    <p id="loginMsg"></p>
  </section>

  <section id="adminSection" style="display:none;">
    <div style="display:flex; gap:8px; align-items:center; justify-content:space-between;">
      <h2>Manage Inventory</h2>
      <button class="btn secondary" id="logoutBtn">Log Out</button>
    </div>

    <h3>Add a Vehicle</h3>
    <form id="vehicleForm" enctype="multipart/form-data">
      <div class="form-row">
        <div>
          <label>Make</label>
          <input name="make" required />
        </div>
        <div>
          <label>Model</label>
          <input name="model" required />
        </div>
      </div>
      <div class="form-row">
        <div>
          <label>Year</label>
          <input name="year" type="number" required />
        </div>
        <div>
          <label>Price (USD)</label>
          <input name="price" type="number" step="0.01" required />
        </div>
      </div>
      <div class="form-row">
        <div>
          <label>Mileage</label>
          <input name="mileage" type="number" required />
        </div>
        <div>
          <label>Color</label>
          <input name="color" />
        </div>
      </div>
      <div>
        <label>Description</label>
        <textarea name="description" rows="4"></textarea>
      </div>
      <div>
        <label>Photos (you can choose multiple)</label>
        <input name="photos" type="file" accept="image/*" multiple />
      </div>
      <p><button class="btn" type="submit">Save Vehicle</button></p>
      <p id="formMsg"></p>
    </form>

    <h3>Current Vehicles</h3>
    <div id="list" class="grid"></div>
  </section>
</main>

<footer class="container">
  <div>&copy; <span id="year"></span> New 2 You Used Autos LLC</div>
</footer>
<script>
document.getElementById('year').textContent = new Date().getFullYear();

const loginSection = document.getElementById('loginSection');
const adminSection = document.getElementById('adminSection');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginMsg = document.getElementById('loginMsg');
const formMsg = document.getElementById('formMsg');
const listDiv = document.getElementById('list');

loginBtn.addEventListener('click', async () => {
  const password = document.getElementById('password').value;
  const res = await fetch('/api/login', {
    method:'POST', headers: {'Content-Type':'application/json'},
    body: JSON.stringify({ password })
  });
  if (res.ok) {
    loginSection.style.display = 'none';
    adminSection.style.display = 'block';
    loadVehicles();
  } else {
    const t = await res.json();
    loginMsg.textContent = t.error || 'Login failed';
  }
});

logoutBtn.addEventListener('click', async () => {
  await fetch('/api/logout', { method:'POST' });
  adminSection.style.display = 'none';
  loginSection.style.display = 'block';
});

async function loadVehicles() {
  const res = await fetch('/api/vehicles');
  const vehicles = await res.json();
  listDiv.innerHTML = vehicles.map(v => `
    <div class="card">
      ${v.images && v.images[0] ? `<img src="${v.images[0]}" alt="vehicle photo" />` : `<img src="/car.png" alt="vehicle" />`}
      <div class="body">
        <div><strong>${v.year || ''} ${v.make || ''} ${v.model || ''}</strong></div>
        <div class="meta">
          <span>${(v.mileage||0).toLocaleString()} mi</span>
          <span>${v.color||''}</span>
        </div>
        <div class="price">$${Number(v.price||0).toLocaleString()}</div>
        <button class="btn danger" onclick="delVehicle('${v.id}')">Delete</button>
      </div>
    </div>
  `).join('');
}

async function delVehicle(id) {
  if (!confirm('Delete this vehicle?')) return;
  const res = await fetch('/api/vehicles/' + id, { method:'DELETE' });
  if (res.ok) loadVehicles();
}

document.getElementById('vehicleForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const form = e.target;
  const data = new FormData(form);
  const res = await fetch('/api/vehicles', { method:'POST', body:data });
  if (res.ok) {
    form.reset();
    formMsg.textContent = 'Saved!';
    loadVehicles();
  } else {
    const t = await res.json();
    formMsg.textContent = t.error || 'Failed to save';
  }
});
</script>
</body>
</html>
